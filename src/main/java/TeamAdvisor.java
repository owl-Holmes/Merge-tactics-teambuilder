package main.java;

import main.java.entities.Card;
import main.java.entities.Team;

import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.util.ArrayList;
import java.util.List;
import java.util.Map;
import java.util.Scanner;
import java.util.function.Function;
import java.util.stream.Collectors;

import static main.java.entities.ExistingCards.*;

/**
 * Main class and launchable program that helps to find a buffed {@link Team} in the ones generated with {@link Main}
 * by giving preexistant cards in your {@link Team}.
 *
 * @author owl
 */
public class TeamAdvisor {

    /**
     * Application entry point. Reads all the teams generated by the {@link Main} in the textual file and asks for the
     * user to enter the preexistant cards in his {@link Team}. This program needs at least one {@link Card}, in
     * all the other cases, you can just read from the {@code teams.txt} file the teams you want.
     *
     * @param args command-line arguments (not used).
     * @throws IllegalArgumentException if the written name of a {@link Card} is not valid.
     * @apiNote This code assumes that the written name of a {@link Card} is valid exactly (without any spelling error)
     * and will throw an {@link IllegalArgumentException} otherwise.
     */
    public static void main(String[] args) throws IOException {
        Scanner scanner = new Scanner(System.in);
        List<Card> currentCards = new ArrayList<>();
        boolean stop;
        do {
            System.out.println("What is the next preexistent card in the Team?");
            String card = scanner.nextLine();
            if(!nameToCard.containsKey(card))
                throw new IllegalArgumentException(card + " is not an admitted card.");
            currentCards.add(nameToCard.get(card));

            System.out.println("Do you still have another preexistant card  ? 0 = No - 1 = Yes");
            int progress = scanner.nextInt();
            scanner.nextLine();
            stop = progress == 1;
        } while (stop);

        System.out.println("Preexistant cards were entered, let's find some teams:");
        List<Team> allTeams = getTeams()
                .stream()
                .filter(x ->
                    currentCards.stream().allMatch(x::contains)
                )
                .toList();

        if(allTeams.isEmpty()){
            System.out.println("No optimized team has that composition.");
        } else {
            for(Team t : allTeams){
                System.out.println(t);
            }
        }
    }

    /**
     * Variable containing and generating a Map from the written names of the cards to the corresponding {@link Card}.
     */
    private static final Map<String, Card> nameToCard =
            allCards().stream()
                    .collect(
                            Collectors.toUnmodifiableMap(
                                    Card::name,
                                    Function.identity()
                            )
                    );

    /**
     * Reads all the generated teams from the {@code teams.txt} file and converts them into {@link Team} instances.
     * Each line of the file must represent a {@link Team} as a comma-separated list of exactly six {@link Card} names,
     * enclosed in brackets. This format is the one used in the writing process in {@link Main}.
     * <strong>Note:</strong> This method assumes that all {@link Card} names found in the file
     * exist in the {@code nameToCard} Map. Missing or unknown {@link Card} names will provoke a
     * {@link NullPointerException} or a {@link IllegalArgumentException}.
     *
     * @return a List of the extracted teams from the textual file.
     * @throws IOException if an I/O error occurs while reading the file.
     * @throws IllegalArgumentException if a line does not contain exactly six cards.
     */
    private static List<Team> getTeams() throws IOException {
        List<Team> teams = new ArrayList<>();

        List<String> lines = Files.readAllLines(Path.of("resources/teams.txt"));

        for (String line : lines) {
            line = line.trim();
            line = line.substring(1, line.length() - 1);
            String[] cardNames = line.split(",");

            if (cardNames.length != 6)
                throw new IllegalArgumentException("Each Team has to be exactly composed of 6 cards: " + line);

            List<Card> cardsOfTheTeam = new ArrayList<>();
            cardsOfTheTeam.add(nameToCard.get(cardNames[0].trim()));
            cardsOfTheTeam.add(nameToCard.get(cardNames[1].trim()));
            cardsOfTheTeam.add(nameToCard.get(cardNames[2].trim()));
            cardsOfTheTeam.add(nameToCard.get(cardNames[3].trim()));
            cardsOfTheTeam.add(nameToCard.get(cardNames[4].trim()));
            cardsOfTheTeam.add(nameToCard.get(cardNames[5].trim()));

            teams.add(Utilities.listToTeam(cardsOfTheTeam));
        }
        return teams;
    }
}


































































































































































































/*
               @@@@%%%@@@@@@
            @@#=:::::----==+#%@@@
          @%+-----------------==*@@@
         @#---------------------=#=*%@
        @*----------------------+#-==+#@@
       @#=----------------------=%=---=+#@@
      @@+#=----------------------#*-----==#@
      @%==#----------------------=#------==+%@
      @#=-#+----------------------**-------=+#@
      @*=-=#=---------------------+#=-------==*@@
      @*---*+----------------------*+--------==*%@
      @*---=#=---------------------+#----------=+%@
      @*----*#----------------------#+----------=+%@
      @#=----#=---------------------+%----------==+@@
      @%=----=%=---------------------%+----------==+@@
      @%=-----+#---------------------+%-----------==+@@
      @@+------**---------------------%*-----------==*@
       @*------=#+--------------------+#------------=+#@
       @%-------+#--------------------=#+------------=+%@
       @@+-------**--------------------+#------------==*@
        @%--------#+-------------------=#=------------==#@
        @@+--------%=-------------------*#-------------==%@
         @#--------=#=------------------=%=------------==+@@
         @%=--------+*-------------------##-------------==#@
          @*---------*+------------------=@=------------==+%@
          @%+--------=#-------------------#*-------------==#@
           @#---------=%------------------=%=------------==+%
            %=---------+#------------------%*-------------==#@
            @%----------+*-----------------+#=------------===@@
             @*----------*+----------------=#+-------------==*@
             @@=---------=#=----------------*#-------------==+@@
              @#----------=#----------------=#=------------===#@
               @*----------+#----------------*#-------------==*@
               @%=----------**---------------=%=------------==+%@
                @%-----------**---------------#*------------===#@
                 @%----------=*=--------------=%------------===*@
                  @#----------=*=--------------#*------------==*%
                   @#----------+*--------------=#=-----------==+%
                   @@*----------+#--------------**-----------===#@
                    @@+----------+*-------------=#=----------===#@
                     @@=----------+*-------------*+-----------==+@@@@@@@@@@@@@@
                       @+---------=*+---===------+*-----------==+@============+*#%%@@@@
                        %+---------=#=============#=---------====@===================+*#%@@@
                        @%+-------===#============+%---------====@+=======================+*#@@@
                          @#---=======*============#+============@+============================+#@@
                           @%=======================%============@+===============================+#@@
                            @%*=====================++===========@+==================================*%@@
                              @##================================@=====================================+#%@
                             @%*================================+%=======================================+*%@
                           @@*==================================+*==========================================#@@
                          @%=-------------===================================================================+%@
                        @@*----------------====================================================================*@@              @@@@
                       @%+------------------====================================================================+%@          @@#+-+@
                      @%---------------------===============================================================+#*++#@@      @%*=----*@
                     @#---:.-----------------==============================================================%#======#@  @@#=-------#@
                    @#=---:------------------=======================================+%*+#%#+=============+%+========#@%====------=%@
                   @%=-----------------------======================================*@:...:#%#+===========#*=================-----*@
                  @%=------------------------======================================%#:....*%%@+=========+#====================--=#@
                 @@=------------------------=======================================#%#=-=*%%%%@+========#*=======================%@
                 @+-------------------------=======================================*@%%%%%%%%%%%========%======================*@@@
                @#-------------------------=====+*#%#*+=============================%%%%%%%%%%%%+======*%==========================#%%@
               @%+-------------------------====*%=...=##+============================%%%%######%*======%*===========================--=*#@@
               @#=------------------------=====@*.....+%@#===========================+%##*****#%+======@===========================-------=*%@@
               @*------------------------=====+@*:...:*%%%#+==========================+%#****+%#=======@==========================------------=#@@
              @%+-----------------------=======%%#+=+#%%%%@*============================+%%#%%+=======+@==========================----------------#@@
              @%==--------------------=========*@%%%%%%%%%%%+==================*======================+@=========================-----------------+%@
              @#===------------------===========%%%%%%%###%@+==================+======================+@=========================-------------+#%@
              @*====-=*#######*=---=============+%%########%+=========%+==============================+@=========================---------=*%@@
             @@+===*#=---------=+#%*=============+%##*****#%+==========================================@==========================-----*%%@
             @@+=+@+=----------=====*%#+===========*%#####%+===========================================@============================#@@
             @@++%+====================*%*============+**+=====================+++=+##****++++*#####**+%#======================+#%@@
 @@@@@@@@@@@@@@**#=======================+##+============================+**++=--::::::::::::::::::::-=*%====================#@@
@%+-:------===++###%#*+=====================##========================*%#=-::::-:--:::::::::::::::::::::#+==================+*@@
 @*-------------------=======================+%+===================+%*--::::::::::::::::::::::::::::::::-#================++++%@
  @#--------------------=======================##===============+%#-::::::::::::::::::::::::::::::::::::-*+=============+++++++@@
   @@=-------------------=======================+#+==========+**=::::::::::::::::::::::::::::::::::::::::=#===========+++++++++#@@
    @@*------------------=========================#========+#+-:::::::::::::::::::::::::::::::::::::::::::=%========+%#*++++++++@@
      @%*--------------============================%+====+#+---::::::::::::::::::::::::::::::::::::::::::::-%+===+++#@@@@@%#*+++%@
        @@+-------=================================+%+==**-:::::::::::::::::::::::::::::::::::::::::::::::::-*#++++%@       @@@@@@
          @%+---====================================+#*#-::::::::::::::::::::::::::::::::::::::::::::::::---==+#%%@@
           @@%++=====================================*#-::::::::::::::::::::::::::::::::::::::::::::::---======+%@
            @@#======================================+*-:::::::::::::::::::::::::::::=+**=::::::::::--=======+#@@
           @#=-=======================================#=::::::::::::::::::::::::::-*%##==%%+:::::---========#@@
         @%=-----------===============================*+:::::::::::::::::::::::::=#=-=#--+**+---=========+#@@
       @@*--------------===============================#::::::::::::::::::::::::+#---==--==-#+=========+#@@
      @#=----------------==============================#::::::::::::::::::::::-%+-----------*#=======+%@@
     @*------------------=================*===========+#:::::::::::::::::::::=#+------------=%====+#%@
   @@+--------------------================@===========*+::::::::::::--------=%+-------------=%=+#%@@                   @@@%##%@@
  @%=-------------------------------=====*%++=========#=-------------======+%+--------------=%@@@                @@@@%#**+**#*+*@@
 @%=-::---------------------------------=%#++++++++++*#===================*%=---------------+%@@@@         @@@@%%#*********#*++##%
@%=----------------=++*#%#--------------=%+++++++++++#+=================+##=-------------===#%##%%%%%%%%%%%##**************+++##*@@
@%****+****##%%%%@@@@@   @*-------------*%+++++++++*%+=================+%*=------------====+%#**********************+++++++++**+#@
                          @%-----------=%@@@%**+*#%*==================*%+==-----===========*%#**********************+++++++++*+#@
                           @@+---------*@    @@@@@%#*+++++++++++++*##%#===-----===========+%#***********************+++++++++*%@
                             @#-------=@@            @@@@%#**#*****#%+===-----============*%#***********************++++++++#%@
                              @%*-----%@                 %*+*****#%+===-----=============+%*%#**********************++++++*%@@
                                @%+--%@                  @#++++##+===-----===============@+=+#@#**********************+*#%@
                                  @@@@                   @%+========----================%======#%##******************#@@@
                                                         @%+=======----================#+:---=*#%*=*#%#**********#%@@@
                                                         @%+======---=================#+:::-**--*+---+%%##**##%%@@@
                                                         @@*====----=================%=:::=#=---*+---+#-#%%@@@@
                                                          @*====----===============*%-:::=#-----=----++--#+=#@@                                     @@
                                                          @*==------=============+%+::::+#---------------=#-:-*@@                                @%##=+@@
                                                          @#==------===========+##-::::+*-----------------*#::::*%@                           @@%=-=*=-#%@
                                                          @%==-------=========**+#::::=#=----------------==%-:::::*%@                      @@%*=---=*--*+*@
                                                          @%=---------===========#=::-#+==---------------==*#::::::-*@                @@@@%*+==--------+-+%
                                                          @@=----------==========++::##===--------------====%-:::::::-#@           @@@%*+=========-------+@
                                                           @+----------===========#=+#====-------------=====%-:::::::::+%@     @@%#+=====================*@
                                                           @#----------===========*#%=====------------======%=::::::::::=%@ @@%#*+++++++++==============+#@
                                                           @%----------===========+%+=====----------========%=:::::::::::=@@%**+*++++*++++++++++++++++++*%@
                                                           @@---------============#*=======-------==========%=::::::::::::+%*****+++*++++++++++++++++++*#@
                                                            @+--------===========+#==========-==============%-::::::::::::-##*+++++++++++++++++++++++++*@@
                                                            @%-------============#+========================+@-::::::::::::-+#*+++++++++++++++****+++++*%@
                                                             @=-----============+#=========================#*:::::::::::--=+#*+++++++++++++++++++++++*%@
                                                             @#--===============#+========================+%-:::::::::--====*#*+++++++++++++++++++++*%@
                                                             @%+================%=========================#+:::::::---======*#*++++++++++++++++++++*%@
                                                              @*===============+*========================*#-::::::--========*#*+++++++++++++++++++*%@
                                                              @%+==============#+=======================+#=:::----==========*#*++++++++++++++++++*@@
                                                              @@#==============*========================%=:----=============##*++++++++++++++++*#@@
                                                               @@+====================================+%+--=================##++++++++++++++++*%@
                                                                @@=================================++*%+===================+%*+++++++++++++++#@@
                                                                 @%==========================++++++*%#+====================+%*+++++++++++++*%@
                                                                  @%+==============++++++++++++++*#%*======================##++++++++++++*%@
                                                                   @%*+++++++++++++++++++++++++*#%#=======================+%*+++**+*+++*#@@
                                                                    @%*+++++++++++++++++++++++#%#+========================%#+++++++++*%@@
                                                                     @@#++++++++++++++++++++++*#+========================#%*+++++++#@@@
                                                                       @%*++++++++++++++++++++%*========================#%++++++*%@@
                                                                        @@%*+++++++++++++++++*@=======================+##*+**#%@@
                                                                          @@#*+++++++++++++++#%======================*%***#%@@
                                                                            @@#*+++++++++++++##============++======+%#%%@@@
                                                                       @@@@@@%%@#*+*+*+++****##===========*++*%*+*%@@@
                                                                @@@@%#*+========+#%#**********@===========#+===+%@
                                                           @@@%#*+=================+#%%#******##==========#*=====+#@
                                                       @@@#*=-::::--===================+**##%%##+=========#+======+*%
                                                   @@@#+--::::::::-:--======================+*+===========#*========+%@
                                                @@@*-:::::::::::::::::--==================+##+============**==========#@
                                            @@@%+-:::::::::::::::::::::::--==============*%+==============*#==========+*@
                                         @@%#+-:::::::::::::::::::::::::::-----========+%*================**============#@
                                       @%*=-::::::::::::::::::::::::::::-:::::-----===##+=================**=============#@
                                    @@#=-:::::::::::::::::::----------::---:::-:::::=%*-==================#*==============#@
                                  @%+:::::::::::::::::::::::::::::::::::::::::::::-#*:::::----============**==============-%@
                               @@#=:::::::::::::::::::::::::::::::::::::::::::::-+#=::::::::::::--------==**=--------------=%@
                             @%*-::::::::::::::::::::::::::::::::::::::::::::::=%+::::::::::::::::::::::--*+----------------#@
                           @@+-::::::::::::::::::::::::::::::::::::::::::::::=#*-:::::::::::::::::::::::::*=:::::::::::::::-+@
                         @@*-:::::::::::::::::::::::::::::::::::::::::::::::*#-::::::::::::::::::::::::::-#-::::::::::::::::=%@
                       @@#-::::::::::::::::::::::::::::::::::::::::::::::-*%-::::::::::::::::::::::::::::=*-::::::::::::::::=%@
                     @@%=::::::::::::::::::::::::::::::::::::::::::::::-+#=::::::::::::::::::::::::::::::++:::::::::::::::::=%@
                    @%+:::::::::::::::::::::::::::::::::::::::::::::::+#=:::::::::::::::::::::::::::::::-*+:::::::::::::::::=%@
                   @#-::::::::::::::::::::::::::::::::::::::::::::::+#=:::::::::::::::::::::::::::::::::-#-:::::::::::::::::+%@
                 @@+::::::::::::::::::::::::::::::::::::::::::::::-#=:::::::::::::::::::::::::::::::::::=*::::::::::::::::::*@
                @#::::::::::::::::::::::::::::::::::::::::::::::-%+:::::::::::::::::::::::::::::::::::::*+:::::::::::::::::-%@
               @*:::::::::::::::::::::::::::::::::::::::::::::-*=::::::::::::::::::::::::::::::::::::::-%-:::::::::::::::::*@
              @*::::::::::::::::::::::::::::::::::::::::::::-*+::::::::::::::::::::::::::::::::::::::::#*:::::::::::::::::*@
             @*:::::::::::::::::::::::::::::::::::::::::::-+-:::::::::::::::::::::::::::::::::::::::::-@-::::::::::::::::*@
            @*:::::::::::::::::::::::::::::::::::::::::::+::::::::::::::::::::::::::::::::::::::::::::#+:::::::::::::::-#@
           @#-:::::::::::::::::::::::::::::::::::::::::-:::::::::::::::::::::::::::::::::::::::::::::=%:::::::::::::::=%@
           @+:::::::::::::::::::::::::::::::::::::::=-::::::::::::::::::::::::::::::::::::::::::::::-#=:::::::::::::-#@@
          @%=::::::::::::::::::::::::::::::::::::-+=::::::::::::::::::::::::::::::::::::::::::::::::+*-:::::::::::-+%@
           %=::::::::::::::::::::::::::::::::::-#+:::::::::::::::::::::::::::::::::::::::::::::::::-#=:::::::::::=%@@
           @+::::::::::::::::::::::::::::::::=%=:::::::::::::::::::::::::::::::::::::::::::::::::::#+::::::::::-%@
           @%-:::::::::::::::::::::::::::::=#=::::::::::::::::::::::::::::::::::::::::::::::::::::#*:::::::::=#@@
            @#:::::::::::::::::::::::::::+#=:::::::::::::::::::::::::::::::::::::::::::::::::::::**::::::::+%@@
             @*:::::::::::::::::::::::-**-::::::::::::::::::::::::::::::::::::::::::::::::::::::++::::::-*%@@
              @#::::::::::::::::::::-#*::::::::::::::::::::::::::::::::::::::::::::::::::::::::=+:::::*@@@
               @%+::::::::::::::::+#+::::::::::::::::::::::::::::::::::::::::::::::::::::::::::-::-*%@@
                 @%=:::::::::::-##-::::::::::::::::::::::::::::::::::::::::::::::::::::::::::--+#@@
                   @%+-::::::+#+-:::::::::::::::::::::::::::::::::::::::::::::::::::::::::-+#@@@
                     @@%+::=+-:::::::::::::::::::::::::::::::::::::::::::::::::::::::-+#%@@@
                        @@%#=::::::::::::::::::::::::::::::::::::::::::::::::::=+#%@@@@
                             @@@%#+=--:::::::::::::::::::::::::::::--==+*#%@@@@
                                   @@@@@@@@%%######%%%%%%@@@@@@@@@@@@
 */